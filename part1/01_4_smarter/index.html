
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../01_3_hpc_architecture/">
      
      
        <link rel="next" href="../01_5_nf_hpc/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>1.4 Work smarter, not harder! - Nextflow on HPC</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-TNWWV3HK57"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-TNWWV3HK57",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-TNWWV3HK57",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#14-work-smarter-not-harder" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Nextflow on HPC" class="md-header__button md-logo" aria-label="Nextflow on HPC" data-md-component="logo">
      
  <img src="../../assets/usyd-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Nextflow on HPC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1.4 Work smarter, not harder!
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Sydney-Informatics-Hub/nextflow-hpc-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Sydney-Informatics-Hub/nextlow-hpc-workshop
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Nextflow on HPC" class="md-nav__button md-logo" aria-label="Nextflow on HPC" data-md-component="logo">
      
  <img src="../../assets/usyd-logo.png" alt="logo">

    </a>
    Nextflow on HPC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Sydney-Informatics-Hub/nextflow-hpc-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Sydney-Informatics-Hub/nextlow-hpc-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Set up
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Part 1
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Part 1
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_0_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.0 Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_1_hpc_for_workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.1 HPC for bioinformatics workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_2_hpc_software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.2 Software is different on HPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_3_hpc_architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.3 HPC architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    1.4 Work smarter, not harder!
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    1.4 Work smarter, not harder!
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#141-know-thyself-tracking-resource-usage-of-your-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4.1 Know thyself: tracking resource usage of your jobs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#142-resource-awareness-right-sizing" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4.2 Resource awareness: right sizing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4.2 Resource awareness: right sizing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        CPU efficiency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-ram-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory (RAM) efficiency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#walltime-awareness" class="md-nav__link">
    <span class="md-ellipsis">
      
        Walltime awareness
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#143-optimising-your-jobs-for-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4.3 Optimising your jobs for efficiency
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4.3 Optimising your jobs for efficiency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallelisation-multi-threading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parallelisation: multi-threading
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallelisation-multi-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parallelisation: multi-processing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#144-optimising-your-jobs-for-cost" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4.4 Optimising your jobs for cost
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_5_nf_hpc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.5 Running Nextflow on HPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_6_nfcore_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.6 Intro to nf-core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_7_nfcore_run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.7 Running nf-core on HPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_8_nfcore_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.8 Configuring nf-core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_9_nfcore_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.9 Layering Nextflow configurations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_10_outro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.10 Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Part 2
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Part 2
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/20_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.0 Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/21_firstrun/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.1 Running a custom pipeline on HPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/22_reporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.2 Pipeline monitoring and reporting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/23_strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.3 Optimising Nextflow for HPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/24_resourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.4 Assigning process resources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/25_parallelisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.5 Parallelisation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/27_scale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.6 Scale to multiple samples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/28_outro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2.7 Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#141-know-thyself-tracking-resource-usage-of-your-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4.1 Know thyself: tracking resource usage of your jobs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#142-resource-awareness-right-sizing" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4.2 Resource awareness: right sizing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4.2 Resource awareness: right sizing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        CPU efficiency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-ram-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory (RAM) efficiency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#walltime-awareness" class="md-nav__link">
    <span class="md-ellipsis">
      
        Walltime awareness
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#143-optimising-your-jobs-for-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4.3 Optimising your jobs for efficiency
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4.3 Optimising your jobs for efficiency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallelisation-multi-threading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parallelisation: multi-threading
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallelisation-multi-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parallelisation: multi-processing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#144-optimising-your-jobs-for-cost" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4.4 Optimising your jobs for cost
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="14-work-smarter-not-harder">1.4 Work smarter, not harder!</h1>
<div class="admonition info">
<p class="admonition-title">Learning objectives</p>
<ul>
<li>Understand how HPC resources affect job scheduling and performance</li>
<li>Describe how HPC scheduling and resource limitations shape pipeline configuration.</li>
<li>Differentiate between multithreading and scatter–gather approaches to parallelisation</li>
<li>Identify how to size resource requests appropriately for each process in a workflow</li>
<li>Apply resource-aware design principles to improve job efficiency and reproducibility</li>
</ul>
</div>
<p>HPC systems give us access to large amounts of compute, but that doesn’t mean we should use resources carelessly. Misusing compute leads to long queue times, wasted allocation, unstable workflows and unhappy HPC administrators. Designing resource-aware workflows is essential for performance and fair use.</p>
<h2 id="141-know-thyself-tracking-resource-usage-of-your-jobs">1.4.1 Know thyself: tracking resource usage of your jobs</h2>
<p>HPC systems are constantly measuring your resource usage. You can use their built in tools to measure actual use. The tools available to you will depend on the job scheduler and the administrator's implementation of the scheduler.</p>
<div class="admonition example">
<p class="admonition-title">Exercise: Inspect a previous job</p>
<p>At the end of the previous lesson, we saved the job ID to a file called <code>run_id.txt</code>. We can use that ID to inspect the resources used by the job:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Gadi (PBSpro)</label><label for="__tabbed_1_2">Setonix (Slurm)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nv">JOBID</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>run_id.txt<span class="k">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>qstat<span class="w"> </span>-xf<span class="w"> </span><span class="si">${</span><span class="nv">JOBID</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;Resource_List|resources_used&quot;</span>
</code></pre></div>
<p>This will generate an output something like:</p>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="go">resources_used.cpupercent = 50</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="go">resources_used.cput = 00:00:04</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="go">resources_used.jobfs = 0b</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="go">resources_used.mem = 451276kb</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="go">resources_used.ncpus = 1</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="go">resources_used.vmem = 451276kb</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="go">resources_used.walltime = 00:00:08</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="go">Resource_List.jobfs = 104857600b</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="go">Resource_List.mem = 1073741824b</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="go">Resource_List.mpiprocs = 1</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="go">Resource_List.ncpus = 1</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="go">Resource_List.nodect = 1</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="go">Resource_List.place = free</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="go">Resource_List.select = 1:ncpus=1:mpiprocs=1:mem=1073741824:job_tags=normalb</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="go">Resource_List.storage = scratch/vp91</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="go">Resource_List.walltime = 00:01:00</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="go">Resource_List.wd = 1</span>
</code></pre></div>
<p>We can see that in this example run, CPU usage was at 50%. Since we only requested 1 CPU, there is no more room for improvement here. We can also see that 451,276 KB (= 440.7 MB) of memory was used, while we requested 1 GB (= 1024 MB), giving us a memory efficiency of ~43%.</p>
<p>Handily, Gadi also produces a summary of the resource usage at the end of its standard output stream. After each of the submitted jobs completed, you should have found two new files present in your working directory, called <code>fastqc.o&lt;JOBNUM&gt;</code> and <code>fastqc.e&lt;JOBNUM&gt;</code>, which are the standard output and standard error streams generated by the job. <code>&lt;JOBNUM&gt;</code> in this case is the numeric part of the job ID; e.g. if the job ID was 12345.gadi-pbs, the standard output file would be <code>fastqc.o12345</code>. The final 12 lines of the <code>fastqc.o&lt;JOBNUM&gt;</code> file will contain the resource summary:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nv">JOBNUM</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">JOBID</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-E<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/\.gadi\-pbs$//g&#39;</span><span class="k">)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">12</span><span class="w"> </span>fastqc.o<span class="si">${</span><span class="nv">JOBNUM</span><span class="si">}</span>
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="go">======================================================================================</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="go">                Resource Usage on 2025-11-07 14:42:47:</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="go">Job Id:             154138075.gadi-pbs</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="go">Project:            vp91</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="go">Exit Status:        0</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="go">Service Units:      0.00</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="go">NCPUs Requested:    1                      NCPUs Used: 1</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="go">                                        CPU Time Used: 00:00:04</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="go">Memory Requested:   1.0GB                 Memory Used: 440.7MB</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="go">Walltime requested: 00:01:00            Walltime Used: 00:00:08</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="go">JobFS requested:    100.0MB                JobFS used: 0B</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="go">======================================================================================</span>
</code></pre></div>
<p>Again, we see that 440.7 MB was used out of the total requested 1 GB.</p>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nv">JOBID</span><span class="o">=</span><span class="k">$(</span>sed<span class="w"> </span>-E<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/^Submitted batch job //g&#39;</span><span class="w"> </span>run_id.txt<span class="k">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sacct<span class="w"> </span>-j<span class="w"> </span><span class="si">${</span><span class="nv">JOBID</span><span class="si">}</span><span class="w"> </span>--format<span class="o">=</span>JobID,JobName,Elapsed,State,AllocCPUS,TotalCPU,MaxRSS
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>seff<span class="w"> </span><span class="si">${</span><span class="nv">JOBID</span><span class="si">}</span>
</code></pre></div>
<p>This will generate an output something like:</p>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="go">JobID           JobName    Elapsed      State  AllocCPUS   TotalCPU     MaxRSS</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="go">------------ ---------- ---------- ---------- ---------- ---------- ----------</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="go">34324060         fastqc   00:00:17  COMPLETED          2  00:07.945</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="go">34324060.ba+      batch   00:00:17  COMPLETED          2  00:07.942    376996K</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="go">34324060.ex+     extern   00:00:17  COMPLETED          2  00:00.003          0</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="go">Job ID: 34324060</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="go">Cluster: setonix</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="go">User/Group: username/username</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="go">State: COMPLETED (exit code 0)</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="go">Nodes: 1</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="go">Cores per node: 2</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="go">CPU Utilized: 00:00:08</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="go">CPU Efficiency: 23.53% of 00:00:34 core-walltime</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="go">Job Wall-clock time: 00:00:17</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="go">Memory Utilized: 368.16 MB</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="go">Memory Efficiency: 35.95% of 1.00 GB (1.00 GB/node)</span>
</code></pre></div>
<p>We can see that in this example run, CPU usage was at 23.53%. Since we only requested 1 CPU, there is no more room for improvement here. We can also see that the memory efficiency was ~36%, using ~368 MB of the requested 1 GB.</p>
</div>
</div>
</div>
<p>Before moving on, delete the <code>results/</code> directory, as well as the scheduler outputs.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Gadi (PBSpro)</label><label for="__tabbed_2_2">Setonix (Slurm)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>rm<span class="w"> </span>-r<span class="w"> </span>results<span class="w"> </span>fastqc.*
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>rm<span class="w"> </span>-r<span class="w"> </span>results<span class="w"> </span>slurm-*
</code></pre></div>
</div>
</div>
</div>
</div>
<h2 id="142-resource-awareness-right-sizing">1.4.2 Resource awareness: right sizing</h2>
<p>At its core, HPC efficiency is about matching the structure of your workflow to the available compute. It is therefore beneficial to be "resource aware" in your approach to running jobs. This involves understanding how much time, CPU, and memory each tool in your workflow actually needs and requesting enough.</p>
<p>Here we focus on 3 metrics:</p>
<ul>
<li>Elapsed time: the total walltime for the job</li>
<li>CPU time: how much CPU time was actually used</li>
<li>Maximum memory (RAM): the peak memory footprint of the job</li>
</ul>
<p>In the context of running a workflow made up of multiple steps, each running a different tool, we consider each step separately in optimising for efficiency.</p>
<p>Let's look again at our workflow:</p>
<p><img alt="" src="../figs/00_workflow01_v2.png" width="80%" /></p>
<p>As we touched on in <a href="../01_1_hpc_for_workflows/#114-introducing-our-workshop-scenario-wgs-short-variant-calling">HPC for workflows</a>, each stage of this workflow has differeing resource requirements and bottlenecks:</p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Dominant resource</th>
<th>Characteristics</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Quality control</strong></td>
<td>I/O-bound</td>
<td>Reads many files; CPU idle time high</td>
</tr>
<tr>
<td><strong>Read alignment</strong></td>
<td>CPU-bound</td>
<td>CPU pegged near 100%; memory stable</td>
</tr>
<tr>
<td><strong>Variant calling</strong></td>
<td>CPU + memory</td>
<td>CPU ~90%, high steady memory usage</td>
</tr>
</tbody>
</table>
<p>We will observe these constraints in subsequent lessons when we run and optimise our workflows.</p>
<div class="admonition note">
<p class="admonition-title">Where can I find this information?</p>
<p>Most mature bioinformatics tools document their approximate resource usage. Keep in mind, documentation will not reflect the reality of your specific dataset and environment. Look at your own resource usage and scaling behaviour to test this.</p>
<p>It's also very helpful to have small-scale datasets to initially test your workflows with. Common practices are to subset FASTQs to a small fraction of the reads, and to subset aligned data to the smaller chromosomes (e.g. chr22 in human data). This will help you quickly (and cheaply!) determine how your workflow behaves at each step and how it will scale with larger datasets.</p>
<p>The more you practice tuning processes for efficiency, the faster you'll develop an intuition for scaling.</p>
</div>
<h3 id="cpu-efficiency">CPU efficiency</h3>
<p>CPU efficiency refers to how well the CPUs requested for the job are being utilised. It is commonly expressed as a percentage or as a range from 0-1. It is calculated as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>CPU time / walltime / number of CPUs
</code></pre></div>
<p>Where:</p>
<ul>
<li>CPU time is the <strong>cumulative</strong> time that all CPUs were actively working; and</li>
<li>Walltime is the real-world time that the job took to run: i.e. the time as measured by a clock on the wall</li>
</ul>
<p>Values near 1 mean your job used all the CPUs efficiently. Values much lower than 1 mean that the CPUs were sitting idle for a lot of the time; this can be because the job was waiting on I/O, or otherwise you may have over-allocated CPUs to your job.</p>
<p>As an example, suppose you requested 4 CPUs for a job which ran for 1 hour (walltime). If each CPU was utilised for 100% of the time, then CPU time would be <strong>4 hours</strong> and CPU efficiency would be:</p>
<div class="admonition note"></div>
<p>4 hours CPU time / 1 hour walltime / 4 CPUs = 100%</p>
<p>On the other hand, if the job actually only used 1 of those CPUs for that entire hour, then CPU time would only be 1 hour and CPU efficiency would be:</p>
<div class="admonition note"></div>
<p>1 hour CPU time / 1 hour walltime / 4 CPUS = 25%</p>
<h3 id="memory-ram-efficiency">Memory (RAM) efficiency</h3>
<p>Memory efficiency describes how much of your allocated memory was truly needed. If your job used close to the requested memory, you're right sized. On the other hand, if the maximum memory used by the job is much lower than requested, then you over-allocated. Your job will fail if maximum memory exceeds the requested allocation.</p>
<p>Note that it is a good idea to <strong>slightly</strong> over-request memory, since it is quite difficult to accurately predict exactly how much memory your job will need, and if you don't have enough of a buffer, you may find that slight fluctuations in the required memory will cause some jobs to fail. From a cost perspective, it is better to pay slightly more for a little more memory than pay twice to re-run a failed job.</p>
<h3 id="walltime-awareness">Walltime awareness</h3>
<p>As mentioned above, walltime is the real-world time it takes for your job to run from start to finish. Schedulers use this value to plan future jobs being run by yourself and others. Overestimating walltime will keep you job in the queue for longer as it will have to wait for a suitable time slot to run. However, if you underestimate walltime, the job will be killed mid-run. As such, like memory, it is usually a good idea to <strong>slightly</strong> over-request walltime, esepcially since you are usually only charged for <strong>actual walltime used</strong>.</p>
<h2 id="143-optimising-your-jobs-for-efficiency">1.4.3 Optimising your jobs for efficiency</h2>
<p>Once you understand how your workflow uses resources, you can start to optimise it. Optimisation is about balancing speed, efficiency, and fair use of the system.</p>
<p>In bioinformatics workflows, there are 2 main strategies used for increasing efficiency and throughput:</p>
<table>
<thead>
<tr>
<th>Level</th>
<th>Definition</th>
<th>Where it runs</th>
<th>Memory model</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Multi-threading</strong></td>
<td>Multiple threads share memory space inside a single process. Threads cooperate to perform a single task faster.</td>
<td>One node</td>
<td>Shared memory</td>
<td>Using the <code>-t</code> or <code>--threads</code> flag on a tool</td>
</tr>
<tr>
<td><strong>Multi-processing</strong></td>
<td>Multiple independent processes run in parallel, each with its own memory space. Often managed by a workflow engine or batch scheduler.</td>
<td>One node or multiple nodes</td>
<td>Separate memory per process</td>
<td>Running <code>fastqc</code> on multiple samples simultaneously</td>
</tr>
</tbody>
</table>
<p><img alt="" src="../figs/00_smarter_multi_diagram.png" /></p>
<p>We can explore parallelisation methods of multi-threading and multi-processing in the context of our variant calling workflow and some small dummy data.</p>
<div class="admonition warning">
<p class="admonition-title">Beware of the overheads</p>
<p>While parallelism can be a great way to speed up your data processing, it doesn't always make things run faster. Splitting your jobs should only be done where it makes practical sense to do so. Keep in mind, the more you split your work up, the more issues you will have to contend with:</p>
<ul>
<li>More job scheduling, more file-handling, more merging</li>
<li>Increased memory footprint and I/O for each sub-job</li>
<li>Diminishing returns when the time saved is offset by coordination cost</li>
</ul>
<p>See <a href="https://gatk.broadinstitute.org/hc/en-us/articles/360035532012-Parallelism-Multithreading-Scatter-Gather">this great explainer</a> of parallelism from the GATK team.</p>
</div>
<h3 id="parallelisation-multi-threading">Parallelisation: multi-threading</h3>
<div class="admonition note">
<p class="admonition-title">What is multi-threading?</p>
<p>Multithreading means one program is using multiple cores on the same node to complete a single task faster. Our ability to do this is dependent on the tool being used. Some bioinformatics tools support multithreading via a flag like <code>--threads</code> or <code>-t</code>.</p>
</div>
<p>In our variant calling workflow, some tools work best when given multiple cores on the same node, e.g. alignment with <code>bwa mem</code>. When you run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>bwa mem -t 4 ref.fasta sample_R1.fq.gz sample_R2.fq.gz &gt; alignment.sam
</code></pre></div>
<p>You're telling BWA to use 4 worker threads for parts of the alignment process that can be parallelised. Not all parts of the process can be parallelised.</p>
<p>Be aware: not all tools can make use of threads effectively, and some are entirely single-threaded. This can stem from biological reasons, i.e. the computational problem simply needs to be run in a sequential manner. In other cases, the tool itself may simply not implement the <code>--threads</code> flag effectively.</p>
<p>For example, the following graph was produced from CPU time and walltime data collected from several runs of <code>bwa mem</code> and <code>fastqc</code>, each with different numbers of threads:</p>
<p><img alt="" src="../figs/00_bwa_vs_fastqc_threads.png" /></p>
<p>Notice that for <code>bwa mem</code>, as the number of threads went up, the walltime (i.e. the number of real-world seconds it took for the job to complete) went down. Also notice that the CPU time stays mostly the same. This indicates that the same amount of computational time was being spent on the job, but because it was spread across more threads and run in parallel, it took fewer seconds to complete.</p>
<p>While many tools benefit from multi-threading, <a href="https://www.biostars.org/p/9598335/">FastQC is not one of them</a>. It is designed to process one file per thread rather than splitting a single file across multiple threads. As you can see in the example above, the walltime for <code>fastqc</code> fluctuates a bit with increasing numbers of threads, but doesn't significantly decrease over time. The CPU time also stays fairly stable. This indicates that <code>fastqc</code> didn't speed up with additional threads.</p>
<div class="admonition warning">
<p class="admonition-title">A note on terminology: threads ≠ cores</p>
<p>Often times you may see terms like "core", and "thread" used interchangeably, but in reality, these are related but distinct concepts.</p>
<ul>
<li><strong>A thread</strong> is a software-level unit of execution. Each thread represents a single stream of instructions within a process.</li>
<li><strong>A core</strong> is a physical processing unit on a computer node. Each core can execute one thread at a time.</li>
</ul>
<p>In practice, when you run a command like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>bwa<span class="w"> </span>mem<span class="w"> </span>-t<span class="w"> </span><span class="m">8</span>
</code></pre></div>
<p>You're telling bwa to spawn 8 threads. For those threads to be executed in parallel, you must <strong>also</strong> request 8 cores from the HPC for those threads to run on. If you were to request only 4 cores, those 8 threads will be competing for 4 cores which causes inefficiency and slower run times. On the other hand, if you ask for more cores than threads, those extra cores will sit idle, wasting allocation and increasing queue time. In summary, always try to request the exact number of cores your job requires. If you have a mixture of tools where one uses lots of threads and another is single-threaded, consider separating them out into separate jobs so that you use the HPC resources efficiently.</p>
<p>You may also see the term <strong>CPU</strong> used interchangeably with <strong>core</strong>. Technically speaking, the CPU is the physical piece of hardware on the computer, composed of one or more cores. However, in practice, we are much more interested in the number of <strong>cores</strong> we are using than the number of physical CPUs. When you ask Gadi or Setonix for "CPUs", you are actually requesting <strong>cores</strong>.</p>
</div>
<h3 id="parallelisation-multi-processing">Parallelisation: multi-processing</h3>
<p>The other main approach to parallelisation is multi-processing, which means running independent processes at the same time, each with its own memory space and input data. Rather than speeding up a single task, it increases overall throughput by running many tasks in parallel. In bioinformatics workflows, this usually looks like processing multiple samples or genomic regions simultaneously.</p>
<p>Multi-processing is typically implemented by the user in workflow design, rather than by a tool itself.</p>
<p>A common multi-processing pattern is called <strong>scatter-gather</strong>. This involves initially splitting a dataset up into many independent jobs and later merging the results back together again. For example, within the context of short variant calling, a common practice is to run the variant calling tools on each chromosome separately. Since a sequencing read can only originate from one chromosome, and because these variants only affect one genomic region at a time, we can safely split the data up per chromosome and treat them independently. Once the data has been processed, the per-chromosome results can be merged back together for downstream analysis.</p>
<p><img alt="" src="../figs/00_smarter_scatter_gather.png" /></p>
<div class="admonition warning">
<p class="admonition-title">Does it make sense biologically to process in parallel?</p>
<p>Not all parallelisation makes sense: it depends on what you're analysing and how the tool interprets the data. Parallelisation makes sense when the data are independent, e.g. running FastQC on multiple fastq files, aligning multiple samples with bwa-mem, or calling SNPs and indels per chromosome.</p>
<p>Paralellisation does not make sense when results depend on comparing all data together e.g. joint genotyping, genome assembly, or detecting structural variants across multiple chromosomes.</p>
</div>
<h2 id="144-optimising-your-jobs-for-cost">1.4.4 Optimising your jobs for cost</h2>
<p>An important issue when designing workflows for HPC is knowing how much it will cost to run. HPCs will typically charge you based on the proportion of available resources you are using, multiplied by some pre-defined rate for the given queue. Both NCI and Pawsey define an intermediate unit called a <strong>service unit</strong> (SU) that captures the effective resource cost of your job; the final real-world cost of the job will be proportional to the number of SUs you use.</p>
<p>The specific calculation for how many SUs a job will use is system-specific, but generally you are charged based on the proportion of available CPUs or available memory that you use, whichever is larger. More specifically:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Gadi (PBSpro)</label><label for="__tabbed_3_2">Setonix (Slurm)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>On Gadi, SUs are calculated as:</p>
<div class="admonition note">
<p>Queue Charge Rate × max(NCPUs, Memory Proportion) × Walltime Used</p>
</div>
<p>Where:</p>
<ul>
<li><strong>Queue Charge Rate</strong> = a specific number of SUs charged per hour for the given queue; queue charge rates are defined on NCI's <a href="https://opus.nci.org.au/spaces/Help/pages/236881198/Queue+Limits...">Queue Limits documentation page</a></li>
<li><strong>NCPUs</strong> = the number of CPUs requested</li>
<li><strong>Memory Proportion</strong> = the proportion of <strong>memory per core</strong> requested</li>
<li><strong>Walltime Used</strong> = the total number of hours the job ran for (<strong>not</strong> the requested walltime)</li>
</ul>
<p><strong>Note</strong> that due to the shared, fair-use nature of HPCs, for billing purposes, NCI divides its memory up evenly per CPU and charges you based on the proportion of either the node's CPUs or memory you use, whichever is greater. For example, on the <code>normal</code> queue, each node has 190 GB of memory and 48 CPUs, meaning there is approximately 4 GB of memory per CPU. If you use less than 4 GB of memory per CPU you request, you will be charged based on the number of CPUs you request; while if you use more than 4 GB of memory per CPU you request, you will be charged based on the amount of memory you use.</p>
<p>For <strong>purely cost-based optimisation</strong>, the ideal ratio of memory per CPU for the <code>normal</code> queue is 190 / 48 = ~4 GB per CPU.</p>
<p>This SU calculation is described further on NCI's <a href="https://opus.nci.org.au/spaces/Help/pages/236880942/Job+Costs...">Job Costs documentaiton page</a></p>
</div>
<div class="tabbed-block">
<p>On Setonix, SUs are calculated as:</p>
<div class="admonition note">
<p>Queue Charge Rate × max(CPU Proportion, Memory Proportion, GPU Proportion) × Number of Nodes × Walltime Used</p>
</div>
<p>Where:</p>
<ul>
<li><strong>Queue Charge Rate</strong> = a specific number of SUs charged per hour per node for the given node type; CPU nodes get charged 128 SUs per node-hour; GPU nodes get charged 512 SU per node-hour.</li>
<li><strong>CPU Proportion</strong> = the proportion of available CPUs per node requested</li>
<li><strong>Memory Proportion</strong> = the proportion of available memory per node requested</li>
<li><strong>GPU Proportion</strong> = the proportion of available GPUs per node requested</li>
<li><strong>Number of Nodes</strong> = the number of nodes requested</li>
<li><strong>Walltime Used</strong> = the total number of hours the job ran for (<strong>not</strong> the requested walltime)</li>
</ul>
<p><strong>Note</strong> that due to the shared, fair-use nature of HPCs, for billing purposes, Pawsey charges you based on the proportion of available CPUs, memory, or GPUs that you request, whichever is greater. For example, on the <code>work</code> queue, each node has 230 GB of memory and 64 CPUs. If you request 1 CPU (1 / 64) and 23 GB memory (1 / 10), you pay for the memory proportion used. If you request 6 CPUs (~ 1 / 10) and 1 GB of memory (1 / 230), you pay for the CPU proportion used.</p>
<p>For <strong>purely cost-based optimisation</strong>, the ideal ratio of memory per CPU for the <code>work</code> queue is 230 / 64 = ~3.5 GB per CPU.</p>
<p>This SU calculation is described further on Pawsey's <a href="https://pawsey.atlassian.net/wiki/spaces/US/pages/51929028/Setonix+General+Information">Setonix General Information page</a></p>
</div>
</div>
</div>
<p><img alt="" src="../figs/00_smarter_proportions.png" /></p>
<p>The above diagram illustrates this method of evenly dividing up the memory per CPU. In this example, we have a compute node with just 10 CPUs and 40 GB of memory. In this case, the memory is divided evenly up per CPU to give 4 GB per CPU. From a cost perspective, if you claim 1 CPU, you effectively claim 4 GB of memory as well; and vice versa, for every 4 GB of memory you claim, you effectively claim 1 CPU.</p>
<p>This billing model is easiest to understand in the extreme cases. If you use the total CPU allocation of a node, no one else can use that node, and so you have effectively used the entire node, regardless of how much of the memory you requested. Similarly, if you request the entire memory allocation of a node, you also use up the entire node's resources, regardless of the number of CPUs you request.</p>
<p>Note that on both Gadi and Setonix, you are only charged for the walltime you <strong>actually use</strong>: you are <strong>not</strong> charged for any unused walltime. The only consequence of over-requesting walltime is potentially longer wait times for your job to start if there are a lot of other jobs queued up. If in doubt of how long a job will take, there is no financial cost to increasing the walltime requested for a job.</p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../01_3_hpc_architecture/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 1.3 HPC architecture">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                1.3 HPC architecture
              </div>
            </div>
          </a>
        
        
          
          <a href="../01_5_nf_hpc/" class="md-footer__link md-footer__link--next" aria-label="Next: 1.5 Running Nextflow on HPC">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                1.5 Running Nextflow on HPC
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.footer", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>