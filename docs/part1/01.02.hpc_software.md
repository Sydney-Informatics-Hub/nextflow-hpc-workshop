# 1.2 HPC fundamentals - Software

## 1.2.1 A simple script

!!! example "Exercise 1.2.1: A simple script: `fastqc`"

    For this part of the workshop, we will be working with a simple script that runs the `fastqc` command. This is a tool that takes one or more FASTQ files and calculates various quality control metrics in order for you to determine whether your data is of good quality.

    We have pre-loaded this script for you in your scratch space within the sub-folder `part1/` and with the name `fastqc.sh`. In VSCode, navigate to and open up the script and inspect it:

    ```bash title="fastqc.sh"
    #!/bin/bash

    SAMPLE_ID="tiny"
    READS_1="data/${SAMPLE_ID}.R1.fq"
    READS_2="data/${SAMPLE_ID}.R2.fq"

    mkdir -p "results/fastqc_${SAMPLE_ID}_logs"
    fastqc \
        --outdir "results/fastqc_${SAMPLE_ID}_logs" \
        --format fastq ${READS_1} ${READS_2}
    ```

    We have also pre-loaded a tiny FASTQ dataset for you to test this script with:

    ```bash
    ls data
    ```

    ```console title="Output"
    tiny.R1.fq  tiny.R2.fq
    ```

    Try running this script and see what happens. Note that you may need to first make this file executable with the `chmod` command:

    ```bash
    # Ensure fastqc.sh is executable
    chmod +x fastqc.sh

    # Try running fastqc.sh
    ./fastqc.sh
    ```

    ??? question "Result..."

        The script will fail with the message `fastqc: command not found`:

        ```console title="Output"
        ./fastqc.sh: line 9: fastqc: command not found
        ```

        Why does this happen? Because by default, the `fastqc` command is not available to us to use on the HPC! But, as we will see, there are two common ways to run tools like `fastqc` on HPC systems.

## 1.2.2 Modules

!!! example "Exercise 1.2.2: Using the `fastqc` module"

    There are lots of modules pre-installed on HPCs like Gadi and Setonix that allow you to use many common tools, including lots of bioinformatics tools. `fastqc` is one such tool that is pre-installed on both of these HPC systems.

    To get started with modules, let's first list all of the modules that are available to us. In the terminal, type the following command:

    ```bash
    module avail
    ```

    The terminal will fill up with a long list of available modules:

    === "Gadi"

        ```console title="Available modules"
        -------------------------------------------------------------------- /opt/Modules/modulefiles ---------------------------------------------------------------------
        pbs  singularity  

        ----------------------------------------------------------------- /opt/Modules/v4.3.0/modulefiles -----------------------------------------------------------------
        dot  module-git  module-info  modules  null  use.own  

        -------------------------------------------------------------------- /apps/Modules/modulefiles --------------------------------------------------------------------
        abaqus/2020                gamess/2021-R2-p1              intel-dnnl/2025.2.0              lammps/3Aug2022           openquake/3.10.1                              
        abaqus/2021                gamess/2022-R2                 intel-dpct/2021.1.1              lammps/3Mar2020           openquake/3.11.2                              
        ```

    === "Setonix"

        ```console title="Available modules"
        ----------------------------------------------- /opt/cray/pe/lmod/modulefiles/mpi/gnu/12.0/ofi/1.0/cray-mpich/8.0 ------------------------------------------------
        cray-hdf5-parallel/1.14.3.1        cray-mpixlate/1.0.5        cray-parallel-netcdf/1.12.3.13 (D)
        cray-hdf5-parallel/1.14.3.3        cray-mpixlate/1.0.6        cray-parallel-netcdf/1.12.3.15
        cray-hdf5-parallel/1.14.3.5 (D)    cray-mpixlate/1.0.7 (D)    cray-parallel-netcdf/1.12.3.17

        ---------------------------------------------- /software/setonix/2025.08/modules/zen3/gcc/14.2.0/astro-applications ----------------------------------------------
        apr-util/1.6.3                  casacore/3.4.0-adios2        giant-squid/2.3.0           mwalib/1.8.7                wcstools/3.9.7
        apr/1.7.5                       casacore/3.4.0-openmp        hyperbeam/0.10.2-cpu        pgplot/5.2.2                wsclean/2.9-idg
        ```

        Note that on Setonix some modules are marked with a `(D)`: this indicates that it is the default version of that module. However, Setonix disables automatic loading of default modules; instead, you must explicitly specify the version you want when loading a module.

    This list can be navigated with the `j` and `k` keys to move down and up, respectively. To exit the list, press `q`.

    Note that the modules appear in a format of `<TOOL NAME>/<VERSION>`. Often, several versions of a tools will be pre-installed on the system for you to choose between.

    Find the available `fastqc` versions on your system with:

    ```bash
    module avail fastqc
    ```

    === "Gadi"

        ```console title="Output"
        -------------------------------------------------------------------- /apps/Modules/modulefiles --------------------------------------------------------------------
        fastqc/0.11.7  fastqc/0.11.8  fastqc/0.12.1 
        ```

    === "Setonix"

        ```console title="Output"
        ------------------------------------------------------- /software/setonix/2025.08/containers/views/modules -------------------------------------------------------
        fastqc/0.11.9--hdfd78af_1
        ```

    You can then load one of these modules with the `module load` command. For the purposes of this workshop, load the latest version available to you:

    === "Gadi"

        On Gadi, you have two options when loading a module. First, you can specify the module version explicitly like so:

        ```bash
        module load fastqc/0.12.1
        ```

        Alternatively, you can omit the version specification and let the module system pick the default version for you; this is typically the most up-to-date version that is installed:

        ```bash
        module load fastqc
        fastqc --version
        ```

        ```console title="Output"
        FastQC v0.12.1
        ```

    === "Setonix"

        As mentioned above, on Setonix you must explicitly specify the version of the module that you want to load. At the time of writing (October 2025), only one version of `fastqc` is loaded on Setonix: `fastqc/0.11.9--hdfd78af_1`

        ```bash
        module load fastqc/0.11.9--hdfd78af_1
        ```

    You can run a quick sanity check that the `fastqc` tool is now loaded by accessing the version information or the help page:

    ```bash
    fastqc --version
    ```

    ```console title="Output: fastqc version"
    FastQC v0.12.1
    ```

    ```bash
    fastqc --help
    ```

    ```console title="Output: fastqc help"
                FastQC - A high throughput sequence QC analysis tool

    SYNOPSIS

            fastqc seqfile1 seqfile2 .. seqfileN

    ...
    ```

    Finally, let's try running our `fastqc.sh` script with the loaded module:

    ```bash
    ./fastqc.sh
    ```

    ```console title="Output"
    Started analysis of tiny.R1.fq
    Analysis complete for tiny.R1.fq
    Started analysis of tiny.R2.fq
    Analysis complete for tiny.R2.fq
    ```

## 1.2.3 Containers

!!! example "Exercise 1.2.3: Using Singularity containers"

    Before we start running containers, we should first **unload** the `fastqc` module from earlier:

    ```bash
    module unload fastqc
    ```

    Singularity, like other software, is not loaded by default. Load it with `module load`:


    === "Gadi"

        On Gadi, there is just one default Singularity module, and can be simply loaded with:

        ```bash
        module load singularity
        ```

    === "Setonix"

        On Setonix, you can find the versions of Singularity available with `module avail`:

        ```bash
        module avail singularity
        ```

        ```console title="Output"
        -------------------------------------------------- /software/setonix/2025.08/modules/zen3/gcc/14.2.0/utilities ---------------------------------------------------
        singularityce/3.11.4    singularityce/4.1.0 (D)

        ------------------------------------------------------------ /software/setonix/2025.08/pawsey/modules ------------------------------------------------------------
        singularity/3.11.4-askap-gpu    singularity/3.11.4-mpi       singularity/3.11.4-slurm       singularity/4.1.0-mpi-gpu    singularity/4.1.0-nompi
        singularity/3.11.4-askap        singularity/3.11.4-nohost    singularity/4.1.0-askap-gpu    singularity/4.1.0-mpi        singularity/4.1.0-slurm (D)
        singularity/3.11.4-mpi-gpu      singularity/3.11.4-nompi     singularity/4.1.0-askap        singularity/4.1.0-nohost
        ```

        There are quite a few versions available; load the version `singularity/4.1.0-slurm`:

        ```bash
        module load singularity/4.1.0-slurm
        ```

    The basic syntax for running commands through a Singularity container is:

    ```bash
    singularity exec [options] /path/to/image <your command>
    ```

    For the purposes of today's workshop, we will be using Singularity's default parameters, so we don't need to provide any options. You will also find a pre-loaded Singularity image for running the `fastqc` command in your current directory under the `singularity/fastqc.sif`.

    Try running the `fastqc.sh` script again, this time through Singularity:

    ```bash
    singularity exec singularity/fastqc.sif ./fastqc.sh
    ```

    You should again see the same output as with the module version of `fastqc`:

    ```console title="Output"
    Started analysis of tiny.R1.fq
    Analysis complete for tiny.R1.fq
    Started analysis of tiny.R2.fq
    Analysis complete for tiny.R2.fq
    ```